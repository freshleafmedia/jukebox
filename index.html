<!doctype html>
<html>
<body>
<style>
    .songResult {
        cursor:pointer;
    }
</style>
<strong>Searcjhh</strong>
<input type="text" id="search" disabled />
<div id="search-container">

</div>
	<script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=googleApiClientReady"></script>
	<script>
        setTimeout(googleApiClientReady, 1000);
		function googleApiClientReady() {
			gapi.client.setApiKey('AIzaSyC5ZNaxUE7HwOxi6r5xMq9aeRlUVdJXU7I');
            gapi.auth.init(function() {
                gapi.client.load('youtube', 'v3', function () {
                    handleAPILoaded();
                });
            });
		}

		function handleAPILoaded()
		{
			$('#search').prop('disabled', false);
		}

        $('#search').on('keyup', function () {
            search($('#search').val());
        });

        function search(query) {
            var request = gapi.client.youtube.search.list({
                q: query,
                part: 'snippet'
            });

            request.execute(function (response) {
//                console.log(response.result);
                $('#search-container').html('');
                $.each(response.result.items, function(index, item) {
                    if (item.id.kind == "youtube#video") {
                        var el = $('<div />', { text: item.snippet.description, 'class': 'songResult' });
                        el.data('url', item.id.videoId);
                        var image = $('<img />', { src: item.snippet.thumbnails.default.url });
                        el.prepend(image);
                        $('#search-container').append(el);
                    }
                })
            });
        }

        $('#search-container').on('click', '> div', function() {
            var id = $(this).data('url');
            addSong(id);
        });

        function addSong(id) {
            console.log('Adding.. ' + id);
            $.ajax('http://192.168.1.77/dj.php', {
                data: {
                    id: id
                },
		success: function(data) {
		    console.log('Song added! [server: ' + data + ']');
		}
            });
        }
	</script>
</body>
</html>
