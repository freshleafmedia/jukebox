(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var Jukebox = require("./jukebox.js").default;
var Search = require("./search.js").default;

var socket = io('//:3000');
socket.on('connect', function () {
    console.log('connected to websocket server');
});

socket.on('disconnect', function () {
    console.log('disconnected');
    $('.media-controls .btn, #shutdown').addClass('disabled');
});

var player = new Jukebox();
var search = new Search(socket);

function notify(title, content) {
    if (window.Notification) {
        if (Notification.permission === "granted") {
            var notification = new Notification(title, { 'body': content, 'icon': '/favicon.ico' });
        } else {
            Notification.requestPermission(function (permission) {
                var notification = new Notification(title, { 'body': content, 'icon': '/favicon.ico' });
            });
        }
    }
}

function updateNowPlaying(title) {
    if (title == '') {
        $('title').text('Freshleaf Jukebox');
    } else {
        $('title').text(title + ' - Freshleaf Jukebox');
    }
}

$(window).on('scroll', function () {
    var y_scroll_pos = window.pageYOffset;
    var scroll_pos_test = 120; // set to whatever you want it to be

    if (y_scroll_pos > scroll_pos_test) {
        $('header').addClass('scrolled');
    } else {
        $('header').removeClass('scrolled');
    }
});

socket.on('playlist', function (playlistData) {
    player.setPlaylist(playlistData);
});

socket.on('songRemove', function (song) {
    player.getPlaylist().removeSong(song);
});

socket.on('songAdd', function (song) {
    player.getPlaylist().addSong(song);
});

navigator.serviceWorker.register('/worker.js', {
    scope: '/'
}).then(function (reg) {
    console.log('service worker registered', reg);
}, function (err) {
    console.log('service worker NOT registered', err);
});

},{"./jukebox.js":2,"./search.js":4}],2:[function(require,module,exports){
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Playlist = require("./playlist.js").default;

var Jukebox = (function () {
    function Jukebox() {
        _classCallCheck(this, Jukebox);

        this.playlists = {};
    }

    _createClass(Jukebox, [{
        key: "setPlaylist",
        value: function setPlaylist(playlistData) {
            // Try and add this playlist
            this.addPlaylist(playlistData);

            this.playlistID = playlistData.ID;
        }
    }, {
        key: "addPlaylist",
        value: function addPlaylist(playlistData, overwrite) {
            // Check if we have already loaded this playlist
            if (overwrite === true || typeof this.playlists[playlistData.ID] === 'undefined') {
                this.playlists[playlistData.ID] = new Playlist(playlistData);
            }
        }
    }, {
        key: "getPlaylist",
        value: function getPlaylist() {
            return this.playlists[this.playlistID];
        }
    }]);

    return Jukebox;
})();

exports.default = Jukebox;

},{"./playlist.js":3}],3:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Playlist = (function () {
    function Playlist(playlistData) {
        _classCallCheck(this, Playlist);

        this.ID = playlistData.ID;
        this.songs = [];
        this.El = $('.queue-container');
        this.build(playlistData);
    }

    _createClass(Playlist, [{
        key: 'build',
        value: function build(playlistData) {
            $.each(playlistData.songs, (function (index, song) {

                this.addSong(song);
            }).bind(this));
        }
    }, {
        key: 'buildSong',
        value: function buildSong(song) {
            var item = $('<div />', { 'class': 'songResult', 'id': 'song-' + song.youTubeID, 'data-state': song.state, 'data-duration': song.data.duration });

            var image = $('<img />', { src: song.thumbnail });
            var title = $('<p />', { 'class': 'title', text: song.data.title });
            var progress = $('<progress />', { value: 0, max: song.data.duration });

            var imgwrap = $('<div />', { 'class': 'imageWrapper' });
            var contentwrap = $('<div />', { 'class': 'contentWrapper' });

            imgwrap.append(image);
            contentwrap.append(title);
            contentwrap.append(progress);
            item.append(imgwrap);
            item.append(contentwrap);

            return item;
        }
    }, {
        key: 'removeSong',
        value: function removeSong(songToRemove) {
            this.El.children('#song-' + songToRemove.youTubeID).remove();

            for (var i = 0; i < this.songs.length; i++) {
                var song = this.songs[i];

                if (song.youTubeID === songToRemove.youTubeID) {
                    this.songs.splice(i, 1);
                    break;
                }
            }
        }
    }, {
        key: 'addSong',
        value: function addSong(song) {
            this.El.append(this.buildSong(song));
        }
    }]);

    return Playlist;
})();

exports.default = Playlist;

},{}],4:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Search = (function () {
    function Search(socket) {
        _classCallCheck(this, Search);

        this.socket = socket;
        this.dialogEl = $('#addDialog');

        this.initGoogleApi(this.searchReady);
        this.initKeyEvents();
        this.initClickEvents();
    }

    _createClass(Search, [{
        key: 'searchReady',
        value: function searchReady() {
            $('#search').prop('disabled', false);
        }
    }, {
        key: 'initGoogleApi',
        value: function initGoogleApi(callback) {
            setTimeout(googleApiClientReady, 1000);
            function googleApiClientReady() {
                gapi.client.setApiKey('AIzaSyC5ZNaxUE7HwOxi6r5xMq9aeRlUVdJXU7I');
                gapi.auth.init(function () {
                    gapi.client.load('youtube', 'v3', function () {
                        callback();
                    });
                });
            }
        }
    }, {
        key: 'initKeyEvents',
        value: function initKeyEvents() {
            var _this = this;

            $(document).keyup(function (event) {
                // Up/Down and j/k keys to navigate selecting a song
                if (event.keyCode == 40 || event.keyCode == 74) {
                    if ($('.highlight').length) {
                        var highlighted = $('.highlight');
                        highlighted.next().addClass('highlight');
                        highlighted.removeClass('highlight');
                    } else {
                        $('#search-container > .songResult:first-child').addClass('highlight');
                    }
                    return;
                }
                if (event.keyCode == 38 || event.keyCode == 75) {
                    if ($('.highlight').length) {
                        var highlighted = $('.highlight');
                        highlighted.prev().addClass('highlight');
                        highlighted.removeClass('highlight');
                    }
                    return;
                }
                // Esc closes dialog
                if (event.keyCode == 27) {
                    _this.closeDialog();
                }
                // Run search on keydown in search box
                if ($(event.target).is('#search')) {
                    if (event.keyCode == 13 && $('.highlight').length) {
                        $('.highlight').click();
                        return;
                    }
                    _this.search($('#search').val());
                }
                // Keys when form input isn't focused
                if (!$(event.target).is('input')) {
                    // A or Enter triggers dialog
                    if (event.keyCode == 65 || event.keyCode == 13) {
                        _this.showDialog();
                    }
                }
            });
        }
    }, {
        key: 'search',
        value: function search(query) {
            var request = gapi.client.youtube.search.list({
                q: query,
                part: 'snippet',
                maxResults: '25'
            });

            request.execute(function (response) {
                $('#search-container').html('');
                $.each(response.result.items, function (index, item) {
                    if (item.id.kind == "youtube#video") {
                        var el = $('<div />', { 'class': 'songResult' });
                        el.data('url', item.id.videoId);
                        var image = $('<img />', { src: item.snippet.thumbnails.default.url });
                        var descWrap = $('<div />');
                        var title = $('<p />', { text: item.snippet.title, 'class': 'title' });
                        //var author = $('<p />', { text: item.snippet.channelTitle, 'class': 'description' });
                        descWrap.append(title);
                        //descWrap.append(author);
                        var imgwrap = $('<div />', { 'class': 'imageWrapper' });
                        imgwrap.append(image);
                        el.append(imgwrap);
                        el.append(descWrap);
                        $('#search-container').append(el);
                    }
                });
            });
        }
    }, {
        key: 'showDialog',
        value: function showDialog() {
            this.dialogEl.show();
            $('#search').focus().val('');
        }
    }, {
        key: 'closeDialog',
        value: function closeDialog() {
            this.dialogEl.hide();
        }
    }, {
        key: 'initClickEvents',
        value: function initClickEvents() {
            var _this2 = this;

            $('#addButton').click(function () {
                _this2.showDialog();
            });
            $('#addDialogClose, .overlay').click(function () {
                _this2.closeDialog();
            });
            $('#search-container').on('click', '> div', function (event) {
                var song = {
                    id: $(event.currentTarget).data('url'),
                    title: $(event.currentTarget).find('p.title').text(),
                    thumbnail: $(event.currentTarget).find('img').attr('src')
                };
                _this2.addSongToPlaylist(song);
                $(event.currentTarget).addClass('added');
            });
        }
    }, {
        key: 'addSongToPlaylist',
        value: function addSongToPlaylist(song) {
            console.log('Adding.. ' + song.id);
            this.socket.emit('addsong', song);
        }
    }]);

    return Search;
})();

exports.default = Search;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9zb3VyY2UvYXBwLmpzIiwianMvc291cmNlL2p1a2Vib3guanMiLCJqcy9zb3VyY2UvcGxheWxpc3QuanMiLCJqcy9zb3VyY2Uvc2VhcmNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQzlDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUM7O0FBRTVDLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMzQixNQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxZQUFVO0FBQzNCLFdBQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztDQUNoRCxDQUFDLENBQUM7O0FBRUgsTUFBTSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsWUFBVTtBQUM5QixXQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQzVCLEtBQUMsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztDQUM3RCxDQUFDLENBQUM7O0FBRUgsSUFBSSxNQUFNLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUMzQixJQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQzs7QUFFaEMsU0FBUyxNQUFNLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRTtBQUM1QixRQUFJLE1BQU0sQ0FBQyxZQUFZLEVBQUU7QUFDckIsWUFBSSxZQUFZLENBQUMsVUFBVSxLQUFLLFNBQVMsRUFBRTtBQUN2QyxnQkFBSSxZQUFZLEdBQUcsSUFBSSxZQUFZLENBQUMsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxN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QUMsQ0FBQyxLQUFLLENBQUMsWUFBTTtBQUN4Qix1QkFBSyxVQUFVLEVBQUUsQ0FBQzthQUNyQixDQUFDLENBQUM7QUFDSCxhQUFDLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxLQUFLLENBQUMsWUFBTTtBQUN2Qyx1QkFBSyxXQUFXLEVBQUUsQ0FBQzthQUN0QixDQUFDLENBQUM7QUFDSCxhQUFDLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxVQUFDLEtBQUssRUFBSztBQUNuRCxvQkFBSSxJQUFJLEdBQUc7QUFDUCxzQkFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUN0Qyx5QkFBSyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksRUFBRTtBQUNwRCw2QkFBUyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7aUJBQzVELENBQUM7QUFDRix1QkFBSyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM3QixpQkFBQyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDNUMsQ0FBQyxDQUFDO1NBRU47OzswQ0FFaUIsSUFBSSxFQUN0QjtBQUNJLG1CQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDbkMsZ0JBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUNyQzs7O1dBeElnQixNQUFNOzs7a0JBQU4sTUFBTSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJ2YXIgSnVrZWJveCA9IHJlcXVpcmUoXCIuL2p1a2Vib3guanNcIikuZGVmYXVsdDtcbnZhciBTZWFyY2ggPSByZXF1aXJlKFwiLi9zZWFyY2guanNcIikuZGVmYXVsdDtcblxudmFyIHNvY2tldCA9IGlvKCcvLzozMDAwJyk7XG5zb2NrZXQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbigpe1xuICAgIGNvbnNvbGUubG9nKCdjb25uZWN0ZWQgdG8gd2Vic29ja2V0IHNlcnZlcicpO1xufSk7XG5cbnNvY2tldC5vbignZGlzY29ubmVjdCcsIGZ1bmN0aW9uKCl7XG4gICAgY29uc29sZS5sb2coJ2Rpc2Nvbm5lY3RlZCcpO1xuICAgICQoJy5tZWRpYS1jb250cm9scyAuYnRuLCAjc2h1dGRvd24nKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbn0pO1xuXG52YXIgcGxheWVyID0gbmV3IEp1a2Vib3goKTtcbnZhciBzZWFyY2ggPSBuZXcgU2VhcmNoKHNvY2tldCk7XG5cbmZ1bmN0aW9uIG5vdGlmeSh0aXRsZSwgY29udGVudCkge1xuICAgIGlmICh3aW5kb3cuTm90aWZpY2F0aW9uKSB7XG4gICAgICAgIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCIpIHtcbiAgICAgICAgICAgIHZhciBub3RpZmljYXRpb24gPSBuZXcgTm90aWZpY2F0aW9uKHRpdGxlLCB7ICdib2R5JzogY29udGVudCwgJ2ljb24nOiAnL2Zhdmljb24uaWNvJyB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbihmdW5jdGlvbihwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24odGl0bGUsIHsgJ2JvZHknOiBjb250ZW50LCAnaWNvbic6ICcvZmF2aWNvbi5pY28nIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZU5vd1BsYXlpbmcodGl0bGUpIHtcbiAgICBpZiAodGl0bGUgPT0gJycpIHtcbiAgICAgICAgJCgndGl0bGUnKS50ZXh0KCdGcmVzaGxlYWYgSnVrZWJveCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICQoJ3RpdGxlJykudGV4dCh0aXRsZSArICcgLSBGcmVzaGxlYWYgSnVrZWJveCcpO1xuICAgIH1cbn1cblxuJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgeV9zY3JvbGxfcG9zID0gd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgIHZhciBzY3JvbGxfcG9zX3Rlc3QgPSAxMjA7ICAgICAgICAgICAgIC8vIHNldCB0byB3aGF0ZXZlciB5b3Ugd2FudCBpdCB0byBiZVxuXG4gICAgaWYoeV9zY3JvbGxfcG9zID4gc2Nyb2xsX3Bvc190ZXN0KSB7XG4gICAgICAgICQoJ2hlYWRlcicpLmFkZENsYXNzKCdzY3JvbGxlZCcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJCgnaGVhZGVyJykucmVtb3ZlQ2xhc3MoJ3Njcm9sbGVkJyk7XG4gICAgfVxufSk7XG5cbnNvY2tldC5vbigncGxheWxpc3QnLCBmdW5jdGlvbihwbGF5bGlzdERhdGEpIHtcbiAgICBwbGF5ZXIuc2V0UGxheWxpc3QocGxheWxpc3REYXRhKTtcbn0pO1xuXG5zb2NrZXQub24oJ3NvbmdSZW1vdmUnLCBmdW5jdGlvbihzb25nKSB7XG4gICAgcGxheWVyLmdldFBsYXlsaXN0KCkucmVtb3ZlU29uZyhzb25nKTtcbn0pO1xuXG5zb2NrZXQub24oJ3NvbmdBZGQnLCBmdW5jdGlvbihzb25nKSB7XG4gICAgcGxheWVyLmdldFBsYXlsaXN0KCkuYWRkU29uZyhzb25nKTtcbn0pO1xuXG5uYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3dvcmtlci5qcycsIHtcbiAgICBzY29wZTogJy8nXG59KS50aGVuKGZ1bmN0aW9uKHJlZykge1xuICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciByZWdpc3RlcmVkJywgcmVnKTtcbn0sIGZ1bmN0aW9uKGVycikge1xuICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBOT1QgcmVnaXN0ZXJlZCcsIGVycik7XG59KTsiLCJ2YXIgUGxheWxpc3QgPSByZXF1aXJlKFwiLi9wbGF5bGlzdC5qc1wiKS5kZWZhdWx0O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBKdWtlYm94XG57XG4gICAgY29uc3RydWN0b3IoKVxuICAgIHtcbiAgICAgICAgdGhpcy5wbGF5bGlzdHMgPSB7fTtcbiAgICB9XG5cbiAgICBzZXRQbGF5bGlzdChwbGF5bGlzdERhdGEpXG4gICAge1xuICAgICAgICAvLyBUcnkgYW5kIGFkZCB0aGlzIHBsYXlsaXN0XG4gICAgICAgIHRoaXMuYWRkUGxheWxpc3QocGxheWxpc3REYXRhKTtcblxuICAgICAgICB0aGlzLnBsYXlsaXN0SUQgPSBwbGF5bGlzdERhdGEuSUQ7XG4gICAgfVxuXG4gICAgYWRkUGxheWxpc3QocGxheWxpc3REYXRhLCBvdmVyd3JpdGUpXG4gICAge1xuICAgICAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGFscmVhZHkgbG9hZGVkIHRoaXMgcGxheWxpc3RcbiAgICAgICAgaWYgKG92ZXJ3cml0ZSA9PT0gdHJ1ZSB8fCB0eXBlb2YgdGhpcy5wbGF5bGlzdHNbcGxheWxpc3REYXRhLklEXSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWxpc3RzW3BsYXlsaXN0RGF0YS5JRF0gPSBuZXcgUGxheWxpc3QocGxheWxpc3REYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFBsYXlsaXN0KClcbiAgICB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0c1t0aGlzLnBsYXlsaXN0SURdO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsYXlsaXN0IHtcblxuICAgIGNvbnN0cnVjdG9yKHBsYXlsaXN0RGF0YSkge1xuICAgICAgICB0aGlzLklEID0gcGxheWxpc3REYXRhLklEO1xuICAgICAgICB0aGlzLnNvbmdzID0gW107XG4gICAgICAgIHRoaXMuRWwgPSAkKCcucXVldWUtY29udGFpbmVyJyk7XG4gICAgICAgIHRoaXMuYnVpbGQocGxheWxpc3REYXRhKTtcbiAgICB9XG5cbiAgICBidWlsZChwbGF5bGlzdERhdGEpXG4gICAge1xuICAgICAgICAkLmVhY2gocGxheWxpc3REYXRhLnNvbmdzLCBmdW5jdGlvbihpbmRleCwgc29uZykge1xuXG4gICAgICAgICAgICB0aGlzLmFkZFNvbmcoc29uZyk7XG5cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBidWlsZFNvbmcoc29uZylcbiAgICB7XG4gICAgICAgIHZhciBpdGVtID0gJCgnPGRpdiAvPicsIHsgJ2NsYXNzJzogJ3NvbmdSZXN1bHQnLCAnaWQnOiAnc29uZy0nK3NvbmcueW91VHViZUlELCAnZGF0YS1zdGF0ZSc6IHNvbmcuc3RhdGUsICdkYXRhLWR1cmF0aW9uJzogc29uZy5kYXRhLmR1cmF0aW9uIH0pO1xuXG4gICAgICAgIHZhciBpbWFnZSA9ICQoJzxpbWcgLz4nLCB7IHNyYzogc29uZy50aHVtYm5haWwgfSk7XG4gICAgICAgIHZhciB0aXRsZSA9ICQoJzxwIC8+JywgeyAnY2xhc3MnOiAndGl0bGUnLCB0ZXh0OiBzb25nLmRhdGEudGl0bGUgfSk7XG4gICAgICAgIHZhciBwcm9ncmVzcyA9ICQoJzxwcm9ncmVzcyAvPicsIHsgdmFsdWU6IDAsIG1heDogc29uZy5kYXRhLmR1cmF0aW9uIH0pO1xuXG4gICAgICAgIHZhciBpbWd3cmFwID0gJCgnPGRpdiAvPicsIHsgJ2NsYXNzJzogJ2ltYWdlV3JhcHBlcicgfSk7XG4gICAgICAgIHZhciBjb250ZW50d3JhcCA9ICQoJzxkaXYgLz4nLCB7ICdjbGFzcyc6ICdjb250ZW50V3JhcHBlcicgfSk7XG5cbiAgICAgICAgaW1nd3JhcC5hcHBlbmQoaW1hZ2UpO1xuICAgICAgICBjb250ZW50d3JhcC5hcHBlbmQodGl0bGUpO1xuICAgICAgICBjb250ZW50d3JhcC5hcHBlbmQocHJvZ3Jlc3MpO1xuICAgICAgICBpdGVtLmFwcGVuZChpbWd3cmFwKTtcbiAgICAgICAgaXRlbS5hcHBlbmQoY29udGVudHdyYXApO1xuXG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgIH1cblxuICAgIHJlbW92ZVNvbmcoc29uZ1RvUmVtb3ZlKVxuICAgIHtcbiAgICAgICAgdGhpcy5FbC5jaGlsZHJlbignI3NvbmctJytzb25nVG9SZW1vdmUueW91VHViZUlEKS5yZW1vdmUoKTtcblxuICAgICAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5zb25ncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHNvbmcgPSB0aGlzLnNvbmdzW2ldO1xuXG4gICAgICAgICAgICBpZihzb25nLnlvdVR1YmVJRCA9PT0gc29uZ1RvUmVtb3ZlLnlvdVR1YmVJRCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc29uZ3Muc3BsaWNlKGksMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRTb25nKHNvbmcpXG4gICAge1xuICAgICAgICB0aGlzLkVsLmFwcGVuZCh0aGlzLmJ1aWxkU29uZyhzb25nKSk7XG4gICAgfVxufVxuXG5cblxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VhcmNoXG57XG4gICAgY29uc3RydWN0b3Ioc29ja2V0KSB7XG4gICAgICAgIHRoaXMuc29ja2V0ID0gc29ja2V0O1xuICAgICAgICB0aGlzLmRpYWxvZ0VsID0gJCgnI2FkZERpYWxvZycpO1xuXG4gICAgICAgIHRoaXMuaW5pdEdvb2dsZUFwaSh0aGlzLnNlYXJjaFJlYWR5KTtcbiAgICAgICAgdGhpcy5pbml0S2V5RXZlbnRzKCk7XG4gICAgICAgIHRoaXMuaW5pdENsaWNrRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgc2VhcmNoUmVhZHkoKVxuICAgIHtcbiAgICAgICAgJCgnI3NlYXJjaCcpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgIH1cblxuICAgIGluaXRHb29nbGVBcGkoY2FsbGJhY2spXG4gICAge1xuICAgICAgICBzZXRUaW1lb3V0KGdvb2dsZUFwaUNsaWVudFJlYWR5LCAxMDAwKTtcbiAgICAgICAgZnVuY3Rpb24gZ29vZ2xlQXBpQ2xpZW50UmVhZHkoKSB7XG4gICAgICAgICAgICBnYXBpLmNsaWVudC5zZXRBcGlLZXkoJ0FJemFTeUM1Wk5heFVFN0h3T3hpNnI1eE1xOWFlUmxVVmRKWFU3SScpO1xuICAgICAgICAgICAgZ2FwaS5hdXRoLmluaXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZ2FwaS5jbGllbnQubG9hZCgneW91dHViZScsICd2MycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdEtleUV2ZW50cygpIHtcbiAgICAgICAgJChkb2N1bWVudCkua2V5dXAoKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAvLyBVcC9Eb3duIGFuZCBqL2sga2V5cyB0byBuYXZpZ2F0ZSBzZWxlY3RpbmcgYSBzb25nXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSA0MCB8fCBldmVudC5rZXlDb2RlID09IDc0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCQoJy5oaWdobGlnaHQnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhpZ2hsaWdodGVkID0gJCgnLmhpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZC5uZXh0KCkuYWRkQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZC5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NlYXJjaC1jb250YWluZXIgPiAuc29uZ1Jlc3VsdDpmaXJzdC1jaGlsZCcpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMzggfHwgZXZlbnQua2V5Q29kZSA9PSA3NSkge1xuICAgICAgICAgICAgICAgIGlmICgkKCcuaGlnaGxpZ2h0JykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoaWdobGlnaHRlZCA9ICQoJy5oaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWQucHJldigpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWQucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBFc2MgY2xvc2VzIGRpYWxvZ1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMjcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSdW4gc2VhcmNoIG9uIGtleWRvd24gaW4gc2VhcmNoIGJveFxuICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5pcygnI3NlYXJjaCcpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMTMgJiYgJCgnLmhpZ2hsaWdodCcpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuaGlnaGxpZ2h0JykuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaCgkKCcjc2VhcmNoJykudmFsKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gS2V5cyB3aGVuIGZvcm0gaW5wdXQgaXNuJ3QgZm9jdXNlZFxuICAgICAgICAgICAgaWYgKCEkKGV2ZW50LnRhcmdldCkuaXMoJ2lucHV0JykpIHtcbiAgICAgICAgICAgICAgICAvLyBBIG9yIEVudGVyIHRyaWdnZXJzIGRpYWxvZ1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDY1IHx8IGV2ZW50LmtleUNvZGUgPT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlhbG9nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZWFyY2gocXVlcnkpXG4gICAge1xuICAgICAgICB2YXIgcmVxdWVzdCA9IGdhcGkuY2xpZW50LnlvdXR1YmUuc2VhcmNoLmxpc3Qoe1xuICAgICAgICAgICAgcTogcXVlcnksXG4gICAgICAgICAgICBwYXJ0OiAnc25pcHBldCcsXG4gICAgICAgICAgICBtYXhSZXN1bHRzOiAnMjUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlcXVlc3QuZXhlY3V0ZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICQoJyNzZWFyY2gtY29udGFpbmVyJykuaHRtbCgnJyk7XG4gICAgICAgICAgICAkLmVhY2gocmVzcG9uc2UucmVzdWx0Lml0ZW1zLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZC5raW5kID09IFwieW91dHViZSN2aWRlb1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQoJzxkaXYgLz4nLCB7J2NsYXNzJzogJ3NvbmdSZXN1bHQnfSk7XG4gICAgICAgICAgICAgICAgICAgIGVsLmRhdGEoJ3VybCcsIGl0ZW0uaWQudmlkZW9JZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9ICQoJzxpbWcgLz4nLCB7c3JjOiBpdGVtLnNuaXBwZXQudGh1bWJuYWlscy5kZWZhdWx0LnVybH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVzY1dyYXAgPSAkKCc8ZGl2IC8+Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9ICQoJzxwIC8+Jywge3RleHQ6IGl0ZW0uc25pcHBldC50aXRsZSwgJ2NsYXNzJzogJ3RpdGxlJ30pO1xuICAgICAgICAgICAgICAgICAgICAvL3ZhciBhdXRob3IgPSAkKCc8cCAvPicsIHsgdGV4dDogaXRlbS5zbmlwcGV0LmNoYW5uZWxUaXRsZSwgJ2NsYXNzJzogJ2Rlc2NyaXB0aW9uJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgZGVzY1dyYXAuYXBwZW5kKHRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgLy9kZXNjV3JhcC5hcHBlbmQoYXV0aG9yKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltZ3dyYXAgPSAkKCc8ZGl2IC8+JywgeydjbGFzcyc6ICdpbWFnZVdyYXBwZXInfSk7XG4gICAgICAgICAgICAgICAgICAgIGltZ3dyYXAuYXBwZW5kKGltYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kKGltZ3dyYXApO1xuICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmQoZGVzY1dyYXApO1xuICAgICAgICAgICAgICAgICAgICAkKCcjc2VhcmNoLWNvbnRhaW5lcicpLmFwcGVuZChlbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2hvd0RpYWxvZygpIHtcbiAgICAgICAgdGhpcy5kaWFsb2dFbC5zaG93KCk7XG4gICAgICAgICQoJyNzZWFyY2gnKS5mb2N1cygpLnZhbCgnJyk7XG4gICAgfVxuXG4gICAgY2xvc2VEaWFsb2coKVxuICAgIHtcbiAgICAgICAgdGhpcy5kaWFsb2dFbC5oaWRlKCk7XG4gICAgfVxuXG4gICAgaW5pdENsaWNrRXZlbnRzKClcbiAgICB7XG4gICAgICAgICQoJyNhZGRCdXR0b24nKS5jbGljaygoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNob3dEaWFsb2coKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoJyNhZGREaWFsb2dDbG9zZSwgLm92ZXJsYXknKS5jbGljaygoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKCcjc2VhcmNoLWNvbnRhaW5lcicpLm9uKCdjbGljaycsICc+IGRpdicsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdmFyIHNvbmcgPSB7XG4gICAgICAgICAgICAgICAgaWQ6ICQoZXZlbnQuY3VycmVudFRhcmdldCkuZGF0YSgndXJsJyksXG4gICAgICAgICAgICAgICAgdGl0bGU6ICQoZXZlbnQuY3VycmVudFRhcmdldCkuZmluZCgncC50aXRsZScpLnRleHQoKSxcbiAgICAgICAgICAgICAgICB0aHVtYm5haWw6ICQoZXZlbnQuY3VycmVudFRhcmdldCkuZmluZCgnaW1nJykuYXR0cignc3JjJylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmFkZFNvbmdUb1BsYXlsaXN0KHNvbmcpO1xuICAgICAgICAgICAgJChldmVudC5jdXJyZW50VGFyZ2V0KS5hZGRDbGFzcygnYWRkZWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBhZGRTb25nVG9QbGF5bGlzdChzb25nKVxuICAgIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0FkZGluZy4uICcgKyBzb25nLmlkKTtcbiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCgnYWRkc29uZycsIHNvbmcpO1xuICAgIH1cbn0iXX0=
