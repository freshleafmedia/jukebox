(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var Jukebox = require("./jukebox.js").default;
var Search = require("./search.js").default;

var socket = io('//:3000');
socket.on('connect', function () {
    console.log('connected to websocket server');
});

socket.on('disconnect', function () {
    console.log('disconnected');
    $('.media-controls .btn, #shutdown').addClass('disabled');
});

var player = new Jukebox();
var search = new Search(socket);

function notify(title, content) {
    if (window.Notification) {
        if (Notification.permission === "granted") {
            var notification = new Notification(title, { 'body': content, 'icon': '/favicon.ico' });
        } else {
            Notification.requestPermission(function (permission) {
                var notification = new Notification(title, { 'body': content, 'icon': '/favicon.ico' });
            });
        }
    }
}

function updateNowPlaying(title) {
    if (title == '') {
        $('title').text('Freshleaf Jukebox');
    } else {
        $('title').text(title + ' - Freshleaf Jukebox');
    }
}

$(window).on('scroll', function () {
    var y_scroll_pos = window.pageYOffset;
    var scroll_pos_test = 120; // set to whatever you want it to be

    if (y_scroll_pos > scroll_pos_test) {
        $('header').addClass('scrolled');
    } else {
        $('header').removeClass('scrolled');
    }
});

socket.on('playlist', function (playlistData) {
    player.setPlaylist(playlistData);
});

socket.on('songRemove', function (song) {
    player.getPlaylist().removeSong(song);
});

socket.on('songAdd', function (song) {
    player.getPlaylist().addSong(song);
});

socket.on('songStatus', function (song) {
    player.getPlaylist().updateSongStatus(song);
});

navigator.serviceWorker.register('/worker.js', {
    scope: '/'
}).then(function (reg) {
    console.log('service worker registered', reg);
}, function (err) {
    console.log('service worker NOT registered', err);
});

},{"./jukebox.js":2,"./search.js":4}],2:[function(require,module,exports){
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Playlist = require("./playlist.js").default;

var Jukebox = (function () {
    function Jukebox() {
        _classCallCheck(this, Jukebox);

        this.playlists = {};
    }

    _createClass(Jukebox, [{
        key: "setPlaylist",
        value: function setPlaylist(playlistData) {
            // Try and add this playlist
            this.addPlaylist(playlistData);

            this.playlistID = playlistData.ID;
        }
    }, {
        key: "addPlaylist",
        value: function addPlaylist(playlistData, overwrite) {
            // Check if we have already loaded this playlist
            if (overwrite === true || typeof this.playlists[playlistData.ID] === 'undefined') {
                this.playlists[playlistData.ID] = new Playlist(playlistData);
            }
        }
    }, {
        key: "getPlaylist",
        value: function getPlaylist() {
            return this.playlists[this.playlistID];
        }
    }]);

    return Jukebox;
})();

exports.default = Jukebox;

},{"./playlist.js":3}],3:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Playlist = (function () {
    function Playlist(playlistData) {
        _classCallCheck(this, Playlist);

        this.ID = playlistData.ID;
        this.songs = [];
        this.El = $('.queue-container');
        this.build(playlistData);
    }

    _createClass(Playlist, [{
        key: 'build',
        value: function build(playlistData) {
            $.each(playlistData.songs, (function (index, song) {

                this.addSong(song);
            }).bind(this));
        }
    }, {
        key: 'buildSong',
        value: function buildSong(song) {
            var item = $('<div />', { 'class': 'songResult', 'id': 'song-' + song.youTubeID, 'data-state': song.state });

            var image = $('<img />', { src: song.thumbnail });
            var duration = $('<p />', { 'class': 'duration', text: song.data.duration });
            var title = $('<p />', { 'class': 'title', text: song.data.title });
            var progress = $('<progress />', { value: song.position, max: song.data.duration });

            var imgwrap = $('<div />', { 'class': 'imageWrapper' });
            var contentwrap = $('<div />', { 'class': 'contentWrapper' });

            imgwrap.append(image);
            contentwrap.append(title);
            contentwrap.append(progress);
            item.append(imgwrap);
            item.append(contentwrap);
            item.append(duration);

            return item;
        }
    }, {
        key: 'removeSong',
        value: function removeSong(songToRemove) {
            this.El.children('#song-' + songToRemove.youTubeID).remove();

            for (var i = 0; i < this.songs.length; i++) {
                var song = this.songs[i];

                if (song.youTubeID === songToRemove.youTubeID) {
                    this.songs.splice(i, 1);
                    break;
                }
            }
        }
    }, {
        key: 'addSong',
        value: function addSong(song) {
            this.El.append(this.buildSong(song));
        }
    }, {
        key: 'updateSongStatus',
        value: function updateSongStatus(song) {
            var songEl = this.El.find('.songResult#song-' + song.youTubeID);
            songEl.attr('data-state', song.state);
            songEl.find('.duration').text(song.data.duration);
            songEl.find('.progress').attr('value', song.position);
        }
    }]);

    return Playlist;
})();

exports.default = Playlist;

},{}],4:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Search = (function () {
    function Search(socket) {
        _classCallCheck(this, Search);

        this.socket = socket;
        this.dialogEl = $('#addDialog');

        this.initGoogleApi(this.searchReady);
        this.initKeyEvents();
        this.initClickEvents();
    }

    _createClass(Search, [{
        key: 'searchReady',
        value: function searchReady() {
            $('#search').prop('disabled', false);
        }
    }, {
        key: 'initGoogleApi',
        value: function initGoogleApi(callback) {
            setTimeout(googleApiClientReady, 1000);
            function googleApiClientReady() {
                gapi.client.setApiKey('AIzaSyC5ZNaxUE7HwOxi6r5xMq9aeRlUVdJXU7I');
                gapi.auth.init(function () {
                    gapi.client.load('youtube', 'v3', function () {
                        callback();
                    });
                });
            }
        }
    }, {
        key: 'initKeyEvents',
        value: function initKeyEvents() {
            var _this = this;

            $(document).keyup(function (event) {
                // Up/Down and j/k keys to navigate selecting a song
                if (event.keyCode == 40 || event.keyCode == 74) {
                    if ($('.highlight').length) {
                        var highlighted = $('.highlight');
                        highlighted.next().addClass('highlight');
                        highlighted.removeClass('highlight');
                    } else {
                        $('#search-container > .songResult:first-child').addClass('highlight');
                    }
                    return;
                }
                if (event.keyCode == 38 || event.keyCode == 75) {
                    if ($('.highlight').length) {
                        var highlighted = $('.highlight');
                        highlighted.prev().addClass('highlight');
                        highlighted.removeClass('highlight');
                    }
                    return;
                }
                // Esc closes dialog
                if (event.keyCode == 27) {
                    _this.closeDialog();
                }
                // Run search on keydown in search box
                if ($(event.target).is('#search')) {
                    if (event.keyCode == 13 && $('.highlight').length) {
                        $('.highlight').click();
                        return;
                    }
                    _this.search($('#search').val());
                }
                // Keys when form input isn't focused
                if (!$(event.target).is('input')) {
                    // A or Enter triggers dialog
                    if (event.keyCode == 65 || event.keyCode == 13) {
                        _this.showDialog();
                    }
                }
            });
        }
    }, {
        key: 'search',
        value: function search(query) {
            var request = gapi.client.youtube.search.list({
                q: query,
                part: 'snippet',
                maxResults: '25'
            });

            request.execute(function (response) {
                $('#search-container').html('');
                $.each(response.result.items, function (index, item) {
                    if (item.id.kind == "youtube#video") {
                        var el = $('<div />', { 'class': 'songResult' });
                        el.data('url', item.id.videoId);
                        var image = $('<img />', { src: item.snippet.thumbnails.default.url });
                        var descWrap = $('<div />');
                        var title = $('<p />', { text: item.snippet.title, 'class': 'title' });
                        //var author = $('<p />', { text: item.snippet.channelTitle, 'class': 'description' });
                        descWrap.append(title);
                        //descWrap.append(author);
                        var imgwrap = $('<div />', { 'class': 'imageWrapper' });
                        imgwrap.append(image);
                        el.append(imgwrap);
                        el.append(descWrap);
                        $('#search-container').append(el);
                    }
                });
            });
        }
    }, {
        key: 'showDialog',
        value: function showDialog() {
            this.dialogEl.show();
            $('#search').focus().val('');
        }
    }, {
        key: 'closeDialog',
        value: function closeDialog() {
            this.dialogEl.hide();
        }
    }, {
        key: 'initClickEvents',
        value: function initClickEvents() {
            var _this2 = this;

            $('#addButton').click(function () {
                _this2.showDialog();
            });
            $('#addDialogClose, .overlay').click(function () {
                _this2.closeDialog();
            });
            $('#search-container').on('click', '> div', function (event) {
                var song = {
                    id: $(event.currentTarget).data('url'),
                    title: $(event.currentTarget).find('p.title').text(),
                    thumbnail: $(event.currentTarget).find('img').attr('src')
                };
                _this2.addSongToPlaylist(song);
                $(event.currentTarget).addClass('added');
            });
        }
    }, {
        key: 'addSongToPlaylist',
        value: function addSongToPlaylist(song) {
            console.log('Adding.. ' + song.id);
            this.socket.emit('addsong', song);
        }
    }]);

    return Search;
})();

exports.default = Search;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9zb3VyY2UvYXBwLmpzIiwianMvc291cmNlL2p1a2Vib3guanMiLCJqcy9zb3VyY2UvcGxheWxpc3QuanMiLCJqcy9zb3VyY2Uvc2VhcmNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQzlDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUM7O0FBRTVDLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMzQixNQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxZQUFVO0FBQzNCLFdBQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztDQUNoRCxDQUFDLENBQUM7O0FBRUgsTUFBTSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsWUFBVTtBQUM5QixXQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQzVCLEtBQUMsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztDQUM3RCxDQUFDLENBQUM7O0FBRUgsSUFBSSxNQUFNLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUMzQixJQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQzs7QUFFaEMsU0FBUyxNQUFNLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRTtBQUM1QixRQUFJLE1BQU0sQ0FBQyxZQUFZLEVBQUU7QUFDckIsWUFBSSxZQUFZLENBQUMsVUFBVSxLQUFLLFNBQVMsRUFBRTtBQUN2QyxnQkFBSSxZQUFZLEdBQUcsSUFBSSxZQUFZLENBQUMsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxN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Q0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7QUFDdEMseUJBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUU7QUFDcEQsNkJBQVMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO2lCQUM1RCxDQUFDO0FBQ0YsdUJBQUssaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDN0IsaUJBQUMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQzVDLENBQUMsQ0FBQztTQUVOOzs7MENBRWlCLElBQUksRUFDdEI7QUFDSSxtQkFBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ25DLGdCQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDckM7OztXQXhJZ0IsTUFBTTs7O2tCQUFOLE1BQU0iLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIEp1a2Vib3ggPSByZXF1aXJlKFwiLi9qdWtlYm94LmpzXCIpLmRlZmF1bHQ7XG52YXIgU2VhcmNoID0gcmVxdWlyZShcIi4vc2VhcmNoLmpzXCIpLmRlZmF1bHQ7XG5cbnZhciBzb2NrZXQgPSBpbygnLy86MzAwMCcpO1xuc29ja2V0Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24oKXtcbiAgICBjb25zb2xlLmxvZygnY29ubmVjdGVkIHRvIHdlYnNvY2tldCBzZXJ2ZXInKTtcbn0pO1xuXG5zb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCBmdW5jdGlvbigpe1xuICAgIGNvbnNvbGUubG9nKCdkaXNjb25uZWN0ZWQnKTtcbiAgICAkKCcubWVkaWEtY29udHJvbHMgLmJ0biwgI3NodXRkb3duJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG59KTtcblxudmFyIHBsYXllciA9IG5ldyBKdWtlYm94KCk7XG52YXIgc2VhcmNoID0gbmV3IFNlYXJjaChzb2NrZXQpO1xuXG5mdW5jdGlvbiBub3RpZnkodGl0bGUsIGNvbnRlbnQpIHtcbiAgICBpZiAod2luZG93Lk5vdGlmaWNhdGlvbikge1xuICAgICAgICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZ3JhbnRlZFwiKSB7XG4gICAgICAgICAgICB2YXIgbm90aWZpY2F0aW9uID0gbmV3IE5vdGlmaWNhdGlvbih0aXRsZSwgeyAnYm9keSc6IGNvbnRlbnQsICdpY29uJzogJy9mYXZpY29uLmljbycgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24oZnVuY3Rpb24ocGVybWlzc2lvbikge1xuICAgICAgICAgICAgICAgIHZhciBub3RpZmljYXRpb24gPSBuZXcgTm90aWZpY2F0aW9uKHRpdGxlLCB7ICdib2R5JzogY29udGVudCwgJ2ljb24nOiAnL2Zhdmljb24uaWNvJyB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVOb3dQbGF5aW5nKHRpdGxlKSB7XG4gICAgaWYgKHRpdGxlID09ICcnKSB7XG4gICAgICAgICQoJ3RpdGxlJykudGV4dCgnRnJlc2hsZWFmIEp1a2Vib3gnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKCd0aXRsZScpLnRleHQodGl0bGUgKyAnIC0gRnJlc2hsZWFmIEp1a2Vib3gnKTtcbiAgICB9XG59XG5cbiQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIHlfc2Nyb2xsX3BvcyA9IHdpbmRvdy5wYWdlWU9mZnNldDtcbiAgICB2YXIgc2Nyb2xsX3Bvc190ZXN0ID0gMTIwOyAgICAgICAgICAgICAvLyBzZXQgdG8gd2hhdGV2ZXIgeW91IHdhbnQgaXQgdG8gYmVcblxuICAgIGlmKHlfc2Nyb2xsX3BvcyA+IHNjcm9sbF9wb3NfdGVzdCkge1xuICAgICAgICAkKCdoZWFkZXInKS5hZGRDbGFzcygnc2Nyb2xsZWQnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoJ2hlYWRlcicpLnJlbW92ZUNsYXNzKCdzY3JvbGxlZCcpO1xuICAgIH1cbn0pO1xuXG5zb2NrZXQub24oJ3BsYXlsaXN0JywgZnVuY3Rpb24ocGxheWxpc3REYXRhKSB7XG4gICAgcGxheWVyLnNldFBsYXlsaXN0KHBsYXlsaXN0RGF0YSk7XG59KTtcblxuc29ja2V0Lm9uKCdzb25nUmVtb3ZlJywgZnVuY3Rpb24oc29uZykge1xuICAgIHBsYXllci5nZXRQbGF5bGlzdCgpLnJlbW92ZVNvbmcoc29uZyk7XG59KTtcblxuc29ja2V0Lm9uKCdzb25nQWRkJywgZnVuY3Rpb24oc29uZykge1xuICAgIHBsYXllci5nZXRQbGF5bGlzdCgpLmFkZFNvbmcoc29uZyk7XG59KTtcblxuc29ja2V0Lm9uKCdzb25nU3RhdHVzJywgZnVuY3Rpb24oc29uZykge1xuICAgIHBsYXllci5nZXRQbGF5bGlzdCgpLnVwZGF0ZVNvbmdTdGF0dXMoc29uZyk7XG59KTtcblxubmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy93b3JrZXIuanMnLCB7XG4gICAgc2NvcGU6ICcvJ1xufSkudGhlbihmdW5jdGlvbihyZWcpIHtcbiAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgcmVnaXN0ZXJlZCcsIHJlZyk7XG59LCBmdW5jdGlvbihlcnIpIHtcbiAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgTk9UIHJlZ2lzdGVyZWQnLCBlcnIpO1xufSk7IiwidmFyIFBsYXlsaXN0ID0gcmVxdWlyZShcIi4vcGxheWxpc3QuanNcIikuZGVmYXVsdDtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSnVrZWJveFxue1xuICAgIGNvbnN0cnVjdG9yKClcbiAgICB7XG4gICAgICAgIHRoaXMucGxheWxpc3RzID0ge307XG4gICAgfVxuXG4gICAgc2V0UGxheWxpc3QocGxheWxpc3REYXRhKVxuICAgIHtcbiAgICAgICAgLy8gVHJ5IGFuZCBhZGQgdGhpcyBwbGF5bGlzdFxuICAgICAgICB0aGlzLmFkZFBsYXlsaXN0KHBsYXlsaXN0RGF0YSk7XG5cbiAgICAgICAgdGhpcy5wbGF5bGlzdElEID0gcGxheWxpc3REYXRhLklEO1xuICAgIH1cblxuICAgIGFkZFBsYXlsaXN0KHBsYXlsaXN0RGF0YSwgb3ZlcndyaXRlKVxuICAgIHtcbiAgICAgICAgLy8gQ2hlY2sgaWYgd2UgaGF2ZSBhbHJlYWR5IGxvYWRlZCB0aGlzIHBsYXlsaXN0XG4gICAgICAgIGlmIChvdmVyd3JpdGUgPT09IHRydWUgfHwgdHlwZW9mIHRoaXMucGxheWxpc3RzW3BsYXlsaXN0RGF0YS5JRF0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXlsaXN0c1twbGF5bGlzdERhdGEuSURdID0gbmV3IFBsYXlsaXN0KHBsYXlsaXN0RGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRQbGF5bGlzdCgpXG4gICAge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdHNbdGhpcy5wbGF5bGlzdElEXTtcbiAgICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQbGF5bGlzdCB7XG5cbiAgICBjb25zdHJ1Y3RvcihwbGF5bGlzdERhdGEpIHtcbiAgICAgICAgdGhpcy5JRCA9IHBsYXlsaXN0RGF0YS5JRDtcbiAgICAgICAgdGhpcy5zb25ncyA9IFtdO1xuICAgICAgICB0aGlzLkVsID0gJCgnLnF1ZXVlLWNvbnRhaW5lcicpO1xuICAgICAgICB0aGlzLmJ1aWxkKHBsYXlsaXN0RGF0YSk7XG4gICAgfVxuXG4gICAgYnVpbGQocGxheWxpc3REYXRhKVxuICAgIHtcbiAgICAgICAgJC5lYWNoKHBsYXlsaXN0RGF0YS5zb25ncywgZnVuY3Rpb24oaW5kZXgsIHNvbmcpIHtcblxuICAgICAgICAgICAgdGhpcy5hZGRTb25nKHNvbmcpO1xuXG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgYnVpbGRTb25nKHNvbmcpXG4gICAge1xuICAgICAgICB2YXIgaXRlbSA9ICQoJzxkaXYgLz4nLCB7ICdjbGFzcyc6ICdzb25nUmVzdWx0JywgJ2lkJzogJ3NvbmctJytzb25nLnlvdVR1YmVJRCwgJ2RhdGEtc3RhdGUnOiBzb25nLnN0YXRlIH0pO1xuXG4gICAgICAgIHZhciBpbWFnZSA9ICQoJzxpbWcgLz4nLCB7IHNyYzogc29uZy50aHVtYm5haWwgfSk7XG4gICAgICAgIHZhciBkdXJhdGlvbiA9ICQoJzxwIC8+JywgeyAnY2xhc3MnOiAnZHVyYXRpb24nLCB0ZXh0OiBzb25nLmRhdGEuZHVyYXRpb24gfSk7XG4gICAgICAgIHZhciB0aXRsZSA9ICQoJzxwIC8+JywgeyAnY2xhc3MnOiAndGl0bGUnLCB0ZXh0OiBzb25nLmRhdGEudGl0bGUgfSk7XG4gICAgICAgIHZhciBwcm9ncmVzcyA9ICQoJzxwcm9ncmVzcyAvPicsIHsgdmFsdWU6IHNvbmcucG9zaXRpb24sIG1heDogc29uZy5kYXRhLmR1cmF0aW9uIH0pO1xuXG4gICAgICAgIHZhciBpbWd3cmFwID0gJCgnPGRpdiAvPicsIHsgJ2NsYXNzJzogJ2ltYWdlV3JhcHBlcicgfSk7XG4gICAgICAgIHZhciBjb250ZW50d3JhcCA9ICQoJzxkaXYgLz4nLCB7ICdjbGFzcyc6ICdjb250ZW50V3JhcHBlcicgfSk7XG5cbiAgICAgICAgaW1nd3JhcC5hcHBlbmQoaW1hZ2UpO1xuICAgICAgICBjb250ZW50d3JhcC5hcHBlbmQodGl0bGUpO1xuICAgICAgICBjb250ZW50d3JhcC5hcHBlbmQocHJvZ3Jlc3MpO1xuICAgICAgICBpdGVtLmFwcGVuZChpbWd3cmFwKTtcbiAgICAgICAgaXRlbS5hcHBlbmQoY29udGVudHdyYXApO1xuICAgICAgICBpdGVtLmFwcGVuZChkdXJhdGlvbik7XG5cbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfVxuXG4gICAgcmVtb3ZlU29uZyhzb25nVG9SZW1vdmUpXG4gICAge1xuICAgICAgICB0aGlzLkVsLmNoaWxkcmVuKCcjc29uZy0nK3NvbmdUb1JlbW92ZS55b3VUdWJlSUQpLnJlbW92ZSgpO1xuXG4gICAgICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLnNvbmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgc29uZyA9IHRoaXMuc29uZ3NbaV07XG5cbiAgICAgICAgICAgIGlmKHNvbmcueW91VHViZUlEID09PSBzb25nVG9SZW1vdmUueW91VHViZUlEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb25ncy5zcGxpY2UoaSwxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFNvbmcoc29uZylcbiAgICB7XG4gICAgICAgIHRoaXMuRWwuYXBwZW5kKHRoaXMuYnVpbGRTb25nKHNvbmcpKTtcbiAgICB9XG5cbiAgICB1cGRhdGVTb25nU3RhdHVzKHNvbmcpXG4gICAge1xuICAgICAgICB2YXIgc29uZ0VsID0gdGhpcy5FbC5maW5kKCcuc29uZ1Jlc3VsdCNzb25nLScgKyBzb25nLnlvdVR1YmVJRCk7XG4gICAgICAgIHNvbmdFbC5hdHRyKCdkYXRhLXN0YXRlJywgc29uZy5zdGF0ZSk7XG4gICAgICAgIHNvbmdFbC5maW5kKCcuZHVyYXRpb24nKS50ZXh0KHNvbmcuZGF0YS5kdXJhdGlvbik7XG4gICAgICAgIHNvbmdFbC5maW5kKCcucHJvZ3Jlc3MnKS5hdHRyKCd2YWx1ZScsIHNvbmcucG9zaXRpb24pO1xuICAgIH1cbn1cblxuXG5cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlYXJjaFxue1xuICAgIGNvbnN0cnVjdG9yKHNvY2tldCkge1xuICAgICAgICB0aGlzLnNvY2tldCA9IHNvY2tldDtcbiAgICAgICAgdGhpcy5kaWFsb2dFbCA9ICQoJyNhZGREaWFsb2cnKTtcblxuICAgICAgICB0aGlzLmluaXRHb29nbGVBcGkodGhpcy5zZWFyY2hSZWFkeSk7XG4gICAgICAgIHRoaXMuaW5pdEtleUV2ZW50cygpO1xuICAgICAgICB0aGlzLmluaXRDbGlja0V2ZW50cygpO1xuICAgIH1cblxuICAgIHNlYXJjaFJlYWR5KClcbiAgICB7XG4gICAgICAgICQoJyNzZWFyY2gnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICB9XG5cbiAgICBpbml0R29vZ2xlQXBpKGNhbGxiYWNrKVxuICAgIHtcbiAgICAgICAgc2V0VGltZW91dChnb29nbGVBcGlDbGllbnRSZWFkeSwgMTAwMCk7XG4gICAgICAgIGZ1bmN0aW9uIGdvb2dsZUFwaUNsaWVudFJlYWR5KCkge1xuICAgICAgICAgICAgZ2FwaS5jbGllbnQuc2V0QXBpS2V5KCdBSXphU3lDNVpOYXhVRTdId094aTZyNXhNcTlhZVJsVVZkSlhVN0knKTtcbiAgICAgICAgICAgIGdhcGkuYXV0aC5pbml0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGdhcGkuY2xpZW50LmxvYWQoJ3lvdXR1YmUnLCAndjMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluaXRLZXlFdmVudHMoKSB7XG4gICAgICAgICQoZG9jdW1lbnQpLmtleXVwKChldmVudCkgPT4ge1xuICAgICAgICAgICAgLy8gVXAvRG93biBhbmQgai9rIGtleXMgdG8gbmF2aWdhdGUgc2VsZWN0aW5nIGEgc29uZ1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gNDAgfHwgZXZlbnQua2V5Q29kZSA9PSA3NCkge1xuICAgICAgICAgICAgICAgIGlmICgkKCcuaGlnaGxpZ2h0JykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoaWdobGlnaHRlZCA9ICQoJy5oaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWQubmV4dCgpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWQucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzZWFyY2gtY29udGFpbmVyID4gLnNvbmdSZXN1bHQ6Zmlyc3QtY2hpbGQnKS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDM4IHx8IGV2ZW50LmtleUNvZGUgPT0gNzUpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCgnLmhpZ2hsaWdodCcpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGlnaGxpZ2h0ZWQgPSAkKCcuaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodGVkLnByZXYoKS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodGVkLnJlbW92ZUNsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRXNjIGNsb3NlcyBkaWFsb2dcbiAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDI3KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUnVuIHNlYXJjaCBvbiBrZXlkb3duIGluIHNlYXJjaCBib3hcbiAgICAgICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuaXMoJyNzZWFyY2gnKSkge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDEzICYmICQoJy5oaWdobGlnaHQnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmhpZ2hsaWdodCcpLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2goJCgnI3NlYXJjaCcpLnZhbCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEtleXMgd2hlbiBmb3JtIGlucHV0IGlzbid0IGZvY3VzZWRcbiAgICAgICAgICAgIGlmICghJChldmVudC50YXJnZXQpLmlzKCdpbnB1dCcpKSB7XG4gICAgICAgICAgICAgICAgLy8gQSBvciBFbnRlciB0cmlnZ2VycyBkaWFsb2dcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSA2NSB8fCBldmVudC5rZXlDb2RlID09IDEzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0RpYWxvZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2VhcmNoKHF1ZXJ5KVxuICAgIHtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBnYXBpLmNsaWVudC55b3V0dWJlLnNlYXJjaC5saXN0KHtcbiAgICAgICAgICAgIHE6IHF1ZXJ5LFxuICAgICAgICAgICAgcGFydDogJ3NuaXBwZXQnLFxuICAgICAgICAgICAgbWF4UmVzdWx0czogJzI1J1xuICAgICAgICB9KTtcblxuICAgICAgICByZXF1ZXN0LmV4ZWN1dGUoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAkKCcjc2VhcmNoLWNvbnRhaW5lcicpLmh0bWwoJycpO1xuICAgICAgICAgICAgJC5lYWNoKHJlc3BvbnNlLnJlc3VsdC5pdGVtcywgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQua2luZCA9PSBcInlvdXR1YmUjdmlkZW9cIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKCc8ZGl2IC8+JywgeydjbGFzcyc6ICdzb25nUmVzdWx0J30pO1xuICAgICAgICAgICAgICAgICAgICBlbC5kYXRhKCd1cmwnLCBpdGVtLmlkLnZpZGVvSWQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSAkKCc8aW1nIC8+Jywge3NyYzogaXRlbS5zbmlwcGV0LnRodW1ibmFpbHMuZGVmYXVsdC51cmx9KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlc2NXcmFwID0gJCgnPGRpdiAvPicpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSAkKCc8cCAvPicsIHt0ZXh0OiBpdGVtLnNuaXBwZXQudGl0bGUsICdjbGFzcyc6ICd0aXRsZSd9KTtcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgYXV0aG9yID0gJCgnPHAgLz4nLCB7IHRleHQ6IGl0ZW0uc25pcHBldC5jaGFubmVsVGl0bGUsICdjbGFzcyc6ICdkZXNjcmlwdGlvbicgfSk7XG4gICAgICAgICAgICAgICAgICAgIGRlc2NXcmFwLmFwcGVuZCh0aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vZGVzY1dyYXAuYXBwZW5kKGF1dGhvcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWd3cmFwID0gJCgnPGRpdiAvPicsIHsnY2xhc3MnOiAnaW1hZ2VXcmFwcGVyJ30pO1xuICAgICAgICAgICAgICAgICAgICBpbWd3cmFwLmFwcGVuZChpbWFnZSk7XG4gICAgICAgICAgICAgICAgICAgIGVsLmFwcGVuZChpbWd3cmFwKTtcbiAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kKGRlc2NXcmFwKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NlYXJjaC1jb250YWluZXInKS5hcHBlbmQoZWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNob3dEaWFsb2coKSB7XG4gICAgICAgIHRoaXMuZGlhbG9nRWwuc2hvdygpO1xuICAgICAgICAkKCcjc2VhcmNoJykuZm9jdXMoKS52YWwoJycpO1xuICAgIH1cblxuICAgIGNsb3NlRGlhbG9nKClcbiAgICB7XG4gICAgICAgIHRoaXMuZGlhbG9nRWwuaGlkZSgpO1xuICAgIH1cblxuICAgIGluaXRDbGlja0V2ZW50cygpXG4gICAge1xuICAgICAgICAkKCcjYWRkQnV0dG9uJykuY2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaG93RGlhbG9nKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKCcjYWRkRGlhbG9nQ2xvc2UsIC5vdmVybGF5JykuY2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpO1xuICAgICAgICB9KTtcbiAgICAgICAgJCgnI3NlYXJjaC1jb250YWluZXInKS5vbignY2xpY2snLCAnPiBkaXYnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHZhciBzb25nID0ge1xuICAgICAgICAgICAgICAgIGlkOiAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmRhdGEoJ3VybCcpLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmZpbmQoJ3AudGl0bGUnKS50ZXh0KCksXG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsOiAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmZpbmQoJ2ltZycpLmF0dHIoJ3NyYycpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5hZGRTb25nVG9QbGF5bGlzdChzb25nKTtcbiAgICAgICAgICAgICQoZXZlbnQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoJ2FkZGVkJyk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgYWRkU29uZ1RvUGxheWxpc3Qoc29uZylcbiAgICB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcuLiAnICsgc29uZy5pZCk7XG4gICAgICAgIHRoaXMuc29ja2V0LmVtaXQoJ2FkZHNvbmcnLCBzb25nKTtcbiAgICB9XG59Il19
