(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var Jukebox = require("./jukebox.js").default;
var Search = require("./search.js").default;

var socket = io('//:3000');
socket.on('connect', function () {
    console.log('connected to websocket server');
    $('#playButton, #pauseButton, #volupButton, #voldownButton, #shuffleSongs, #forwardButton').removeClass('disabled');
});

socket.on('disconnect', function () {
    console.log('disconnected');
    $('.media-controls .btn, #shutdown, #shuffleSongs').addClass('disabled');
});

var player = new Jukebox(socket);
var search = new Search(socket);

function notify(title, content) {
    if (window.Notification) {
        if (Notification.permission === "granted") {
            var notification = new Notification(title, { 'body': content, 'icon': '/favicon.ico' });
        } else {
            Notification.requestPermission(function (permission) {
                var notification = new Notification(title, { 'body': content, 'icon': '/favicon.ico' });
            });
        }
    }
}

function updateNowPlaying(title) {
    if (title == '') {
        $('title').text('Freshleaf Jukebox');
    } else {
        $('title').text(title + ' - Freshleaf Jukebox');
    }
}

$(window).on('scroll', function () {
    var y_scroll_pos = window.pageYOffset;
    var scroll_pos_test = 120; // set to whatever you want it to be

    if (y_scroll_pos > scroll_pos_test) {
        $('header').addClass('scrolled');
    } else {
        $('header').removeClass('scrolled');
    }
});

socket.on('playlist', function (playlistData) {
    player.setPlaylist(playlistData);
});

socket.on('songRemove', function (song) {
    player.getPlaylist().removeSong(song);
});

socket.on('songAdd', function (song) {
    notify('Song Added', song.data.title);
    player.getPlaylist().addSong(song);
});

socket.on('songStatus', function (song) {
    if (song.state === 'playing') {
        notify('Now Playing', song.data.title);
    }
    player.getPlaylist().updateSongStatus(song);
});

socket.on('songPosition', function (position) {
    player.getPlaylist().updateSongPosition(position);
});

if (typeof navigator.serviceWorker !== 'undefined') {
    navigator.serviceWorker.register('/worker.js', {
        scope: '/'
    }).then(function (reg) {
        console.log('service worker registered', reg);
    }, function (err) {
        console.log('service worker NOT registered', err);
    });
}

},{"./jukebox.js":2,"./search.js":4}],2:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Playlist = require("./playlist.js").default;

var Jukebox = (function () {
    function Jukebox(socket) {
        _classCallCheck(this, Jukebox);

        this.socket = socket;
        this.playlists = {};
        this.setEventHandlers();
    }

    _createClass(Jukebox, [{
        key: 'setEventHandlers',
        value: function setEventHandlers() {
            var _this = this;

            $(document).on('click', 'button[data-action]', function (e) {
                if ($(e.currentTarget).hasClass('disabled')) {
                    console.warn('Button disabled');
                    return;
                }

                // Get the action to send
                var action = $(e.currentTarget).attr('data-action');

                _this.control(action);
            });
        }
    }, {
        key: 'control',
        value: function control(action) {
            console.log('Sending action: ' + action);
            this.socket.emit('control', action);
        }
    }, {
        key: 'setPlaylist',
        value: function setPlaylist(playlistData) {
            // Try and add this playlist
            this.addPlaylist(playlistData, true);

            this.playlistID = playlistData.ID;
        }
    }, {
        key: 'addPlaylist',
        value: function addPlaylist(playlistData, overwrite) {
            // Check if we have already loaded this playlist
            if (overwrite === true || typeof this.playlists[playlistData.ID] === 'undefined') {
                this.playlists[playlistData.ID] = new Playlist(playlistData);
            }
        }
    }, {
        key: 'getPlaylist',
        value: function getPlaylist() {
            return this.playlists[this.playlistID];
        }
    }]);

    return Jukebox;
})();

exports.default = Jukebox;

},{"./playlist.js":3}],3:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Playlist = (function () {
    function Playlist(playlistData) {
        _classCallCheck(this, Playlist);

        this.ID = playlistData.ID;
        this.songs = [];
        this.El = $('.queue-container');
        this.build(playlistData);
    }

    _createClass(Playlist, [{
        key: 'build',
        value: function build(playlistData) {
            //Clear the current playlist
            this.El.html('');

            $.each(playlistData.songs, (function (index, song) {

                this.addSong(song);
            }).bind(this));
        }
    }, {
        key: 'buildSong',
        value: function buildSong(song) {
            var item = $('<div />', { 'class': 'songResult', 'id': 'song-' + song.id, 'data-state': song.state });

            var image = $('<img />', { src: song.thumbnail });
            var duration = $('<p />', { 'class': 'duration', text: (song.data.duration / 60).toFixed(2) });
            var title = $('<p />', { 'class': 'title', text: song.data.title });
            var progress = $('<progress />', { value: song.position, max: song.data.duration });
            var username = $('<p />', { 'class': 'username', text: song.username });

            var imgwrap = $('<div />', { 'class': 'imageWrapper' });
            var contentwrap = $('<div />', { 'class': 'contentWrapper' });

            imgwrap.append(image);
            contentwrap.append(title);
            contentwrap.append(progress);
            item.append(imgwrap);
            item.append(contentwrap);
            item.append(username);
            item.append(duration);

            return item;
        }
    }, {
        key: 'removeSong',
        value: function removeSong(songToRemove) {
            this.El.children('#song-' + songToRemove.id).remove();

            for (var i = 0; i < this.songs.length; i++) {
                var song = this.songs[i];

                if (song.id === songToRemove.id) {
                    this.songs.splice(i, 1);
                    break;
                }
            }
        }
    }, {
        key: 'addSong',
        value: function addSong(song) {
            this.El.append(this.buildSong(song));
        }
    }, {
        key: 'updateSongStatus',
        value: function updateSongStatus(song) {
            var songEl = this.El.find('.songResult#song-' + song.id);
            songEl.attr('data-state', song.state);
            songEl.find('.duration').text((song.data.duration / 60).toFixed(2));
            songEl.find('progress').attr('value', song.position);
            songEl.find('progress').attr('max', song.data.duration);
        }
    }, {
        key: 'updateSongPosition',
        value: function updateSongPosition(position) {
            var songEl = this.El.find('.songResult[data-state=playing]');
            songEl.find('progress').attr('value', position);
        }
    }]);

    return Playlist;
})();

exports.default = Playlist;

},{}],4:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Search = (function () {
    function Search(socket) {
        _classCallCheck(this, Search);

        this.socket = socket;
        this.dialogEl = $('#addDialog');
        this.userSetupEl = $('#user-setup');
        this.searchControlsEl = $('#search-controls');

        this.initUser();
        this.initGoogleApi(this.searchReady);
        this.initKeyEvents();
        this.initClickEvents();
    }

    _createClass(Search, [{
        key: 'initUser',
        value: function initUser() {
            var _this = this;

            if (localStorage.getItem('username')) {
                this.userSetupEl.hide();
                this.searchControlsEl.show();
            }
            $('#addUser').submit(function (e) {
                e.preventDefault();
                if ($('#username').val() != "") {
                    localStorage.setItem('username', $('#username').val());
                    _this.userSetupEl.hide();
                    _this.searchControlsEl.show();
                }
            });
        }
    }, {
        key: 'searchReady',
        value: function searchReady() {
            $('#search').prop('disabled', false);
        }
    }, {
        key: 'initGoogleApi',
        value: function initGoogleApi(callback) {
            setTimeout(googleApiClientReady, 1000);
            function googleApiClientReady() {
                gapi.client.setApiKey('AIzaSyC5ZNaxUE7HwOxi6r5xMq9aeRlUVdJXU7I');
                gapi.auth.init(function () {
                    gapi.client.load('youtube', 'v3', function () {
                        callback();
                    });
                });
            }
        }
    }, {
        key: 'initKeyEvents',
        value: function initKeyEvents() {
            var _this2 = this;

            $(document).keyup(function (event) {
                // Up/Down and j/k keys to navigate selecting a song
                if (event.keyCode == 40 || event.keyCode == 74) {
                    if ($('.highlight').length) {
                        var highlighted = $('.highlight');
                        highlighted.next().addClass('highlight');
                        highlighted.removeClass('highlight');
                    } else {
                        $('#search-container > .songResult:first-child').addClass('highlight');
                    }
                    return;
                }
                if (event.keyCode == 38 || event.keyCode == 75) {
                    if ($('.highlight').length) {
                        var highlighted = $('.highlight');
                        highlighted.prev().addClass('highlight');
                        highlighted.removeClass('highlight');
                    }
                    return;
                }
                // Esc closes dialog
                if (event.keyCode == 27) {
                    _this2.closeDialog();
                }
                // Run search on keydown in search box
                if ($(event.target).is('#search')) {
                    if (event.keyCode == 13 && $('.highlight').length) {
                        $('.highlight').click();
                        return;
                    }
                    _this2.search($('#search').val());
                }
                // Keys when form input isn't focused
                if (!$(event.target).is('input')) {
                    // A or Enter triggers dialog
                    if (event.keyCode == 65 || event.keyCode == 13) {
                        _this2.showDialog();
                    }
                }
            });
        }
    }, {
        key: 'search',
        value: function search(query) {
            var request = gapi.client.youtube.search.list({
                q: query,
                part: 'snippet',
                maxResults: '25'
            });

            request.execute(function (response) {
                $('#search-container').html('');
                $.each(response.result.items, function (index, item) {
                    if (item.id.kind == "youtube#video") {
                        var el = $('<div />', { 'class': 'songResult' });
                        el.data('url', item.id.videoId);
                        var image = $('<img />', { src: item.snippet.thumbnails.default.url });
                        var descWrap = $('<div />');
                        var title = $('<p />', { text: item.snippet.title, 'class': 'title' });
                        //var author = $('<p />', { text: item.snippet.channelTitle, 'class': 'description' });
                        descWrap.append(title);
                        //descWrap.append(author);
                        var imgwrap = $('<div />', { 'class': 'imageWrapper' });
                        imgwrap.append(image);
                        el.append(imgwrap);
                        el.append(descWrap);
                        $('#search-container').append(el);
                    }
                });
            });
        }
    }, {
        key: 'showDialog',
        value: function showDialog() {
            this.dialogEl.show();
            if (localStorage.getItem('username')) {
                $('#search').focus().val('');
            } else {
                $('#username').focus().val('');
            }
        }
    }, {
        key: 'closeDialog',
        value: function closeDialog() {
            this.dialogEl.hide();
        }
    }, {
        key: 'initClickEvents',
        value: function initClickEvents() {
            var _this3 = this;

            $('#addButton').click(function () {
                _this3.showDialog();
            });
            $('#addDialogClose, .overlay').click(function () {
                _this3.closeDialog();
            });
            $('#search-container').on('click', '> div', function (event) {
                var song = {
                    id: $(event.currentTarget).data('url'),
                    title: $(event.currentTarget).find('p.title').text(),
                    thumbnail: $(event.currentTarget).find('img').attr('src'),
                    username: localStorage.getItem('username')
                };
                _this3.addSongToPlaylist(song);
                $(event.currentTarget).addClass('added');
            });
        }
    }, {
        key: 'addSongToPlaylist',
        value: function addSongToPlaylist(song) {
            console.log('Adding.. ' + song.id);
            this.socket.emit('addsong', song);
        }
    }]);

    return Search;
})();

exports.default = Search;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9zb3VyY2UvYXBwLmpzIiwianMvc291cmNlL2p1a2Vib3guanMiLCJqcy9zb3VyY2UvcGxheWxpc3QuanMiLCJqcy9zb3VyY2Uvc2VhcmNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQzlDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUM7O0FBRTVDLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMzQixNQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxZQUFVO0FBQzNCLFdBQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQUM3QyxLQUFDLENBQUMsd0ZBQXdGLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7Q0FDdkgsQ0FBQyxDQUFDOztBQUVILE1BQU0sQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLFlBQVU7QUFDOUIsV0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUM1QixLQUFDLENBQUMsZ0RBQWdELENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7Q0FDNUUsQ0FBQyxDQUFDOztBQUVILElBQUksTUFBTSxHQUFHLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ2pDLElBQUksTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDOztBQUVoQyxTQUFTLE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFO0FBQzVCLFFBQUksTUFBTSxDQUFDLFlBQVksRUFBRTtBQUNyQixZQUFJLFlBQVksQ0FBQyxVQUFVLEtBQUssU0FBUyxFQUFFO0FBQ3ZD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O2FBQzVDLENBQUMsQ0FBQztTQUVOOzs7MENBRWlCLElBQUksRUFDdEI7QUFDSSxtQkFBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ25DLGdCQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDckM7OztXQWhLZ0IsTUFBTTs7O2tCQUFOLE1BQU0iLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIEp1a2Vib3ggPSByZXF1aXJlKFwiLi9qdWtlYm94LmpzXCIpLmRlZmF1bHQ7XG52YXIgU2VhcmNoID0gcmVxdWlyZShcIi4vc2VhcmNoLmpzXCIpLmRlZmF1bHQ7XG5cbnZhciBzb2NrZXQgPSBpbygnLy86MzAwMCcpO1xuc29ja2V0Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24oKXtcbiAgICBjb25zb2xlLmxvZygnY29ubmVjdGVkIHRvIHdlYnNvY2tldCBzZXJ2ZXInKTtcbiAgICAkKCcjcGxheUJ1dHRvbiwgI3BhdXNlQnV0dG9uLCAjdm9sdXBCdXR0b24sICN2b2xkb3duQnV0dG9uLCAjc2h1ZmZsZVNvbmdzLCAjZm9yd2FyZEJ1dHRvbicpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xufSk7XG5cbnNvY2tldC5vbignZGlzY29ubmVjdCcsIGZ1bmN0aW9uKCl7XG4gICAgY29uc29sZS5sb2coJ2Rpc2Nvbm5lY3RlZCcpO1xuICAgICQoJy5tZWRpYS1jb250cm9scyAuYnRuLCAjc2h1dGRvd24sICNzaHVmZmxlU29uZ3MnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbn0pO1xuXG52YXIgcGxheWVyID0gbmV3IEp1a2Vib3goc29ja2V0KTtcbnZhciBzZWFyY2ggPSBuZXcgU2VhcmNoKHNvY2tldCk7XG5cbmZ1bmN0aW9uIG5vdGlmeSh0aXRsZSwgY29udGVudCkge1xuICAgIGlmICh3aW5kb3cuTm90aWZpY2F0aW9uKSB7XG4gICAgICAgIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCIpIHtcbiAgICAgICAgICAgIHZhciBub3RpZmljYXRpb24gPSBuZXcgTm90aWZpY2F0aW9uKHRpdGxlLCB7ICdib2R5JzogY29udGVudCwgJ2ljb24nOiAnL2Zhdmljb24uaWNvJyB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbihmdW5jdGlvbihwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24odGl0bGUsIHsgJ2JvZHknOiBjb250ZW50LCAnaWNvbic6ICcvZmF2aWNvbi5pY28nIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZU5vd1BsYXlpbmcodGl0bGUpIHtcbiAgICBpZiAodGl0bGUgPT0gJycpIHtcbiAgICAgICAgJCgndGl0bGUnKS50ZXh0KCdGcmVzaGxlYWYgSnVrZWJveCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICQoJ3RpdGxlJykudGV4dCh0aXRsZSArICcgLSBGcmVzaGxlYWYgSnVrZWJveCcpO1xuICAgIH1cbn1cblxuJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgeV9zY3JvbGxfcG9zID0gd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgIHZhciBzY3JvbGxfcG9zX3Rlc3QgPSAxMjA7ICAgICAgICAgICAgIC8vIHNldCB0byB3aGF0ZXZlciB5b3Ugd2FudCBpdCB0byBiZVxuXG4gICAgaWYoeV9zY3JvbGxfcG9zID4gc2Nyb2xsX3Bvc190ZXN0KSB7XG4gICAgICAgICQoJ2hlYWRlcicpLmFkZENsYXNzKCdzY3JvbGxlZCcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJCgnaGVhZGVyJykucmVtb3ZlQ2xhc3MoJ3Njcm9sbGVkJyk7XG4gICAgfVxufSk7XG5cbnNvY2tldC5vbigncGxheWxpc3QnLCBmdW5jdGlvbihwbGF5bGlzdERhdGEpIHtcbiAgICBwbGF5ZXIuc2V0UGxheWxpc3QocGxheWxpc3REYXRhKTtcbn0pO1xuXG5zb2NrZXQub24oJ3NvbmdSZW1vdmUnLCBmdW5jdGlvbihzb25nKSB7XG4gICAgcGxheWVyLmdldFBsYXlsaXN0KCkucmVtb3ZlU29uZyhzb25nKTtcbn0pO1xuXG5zb2NrZXQub24oJ3NvbmdBZGQnLCBmdW5jdGlvbihzb25nKSB7XG4gICAgbm90aWZ5KCdTb25nIEFkZGVkJywgc29uZy5kYXRhLnRpdGxlKTtcbiAgICBwbGF5ZXIuZ2V0UGxheWxpc3QoKS5hZGRTb25nKHNvbmcpO1xufSk7XG5cbnNvY2tldC5vbignc29uZ1N0YXR1cycsIGZ1bmN0aW9uKHNvbmcpIHtcbiAgICBpZihzb25nLnN0YXRlID09PSAncGxheWluZycpIHtcbiAgICAgICAgbm90aWZ5KCdOb3cgUGxheWluZycsIHNvbmcuZGF0YS50aXRsZSk7XG4gICAgfVxuICAgIHBsYXllci5nZXRQbGF5bGlzdCgpLnVwZGF0ZVNvbmdTdGF0dXMoc29uZyk7XG59KTtcblxuc29ja2V0Lm9uKCdzb25nUG9zaXRpb24nLCBmdW5jdGlvbihwb3NpdGlvbikge1xuICAgIHBsYXllci5nZXRQbGF5bGlzdCgpLnVwZGF0ZVNvbmdQb3NpdGlvbihwb3NpdGlvbik7XG59KTtcblxuaWYgKHR5cGVvZiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3dvcmtlci5qcycsIHtcbiAgICAgICAgc2NvcGU6ICcvJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlZykge1xuICAgICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgcmVnaXN0ZXJlZCcsIHJlZyk7XG4gICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgTk9UIHJlZ2lzdGVyZWQnLCBlcnIpO1xuICAgIH0pO1xufSIsInZhciBQbGF5bGlzdCA9IHJlcXVpcmUoXCIuL3BsYXlsaXN0LmpzXCIpLmRlZmF1bHQ7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEp1a2Vib3hcbntcbiAgICBjb25zdHJ1Y3Rvcihzb2NrZXQpXG4gICAge1xuICAgICAgICB0aGlzLnNvY2tldCA9IHNvY2tldDtcbiAgICAgICAgdGhpcy5wbGF5bGlzdHMgPSB7fTtcbiAgICAgICAgdGhpcy5zZXRFdmVudEhhbmRsZXJzKCk7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRIYW5kbGVycygpIHtcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2J1dHRvbltkYXRhLWFjdGlvbl0nLCAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCQoZS5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQnV0dG9uIGRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBHZXQgdGhlIGFjdGlvbiB0byBzZW5kXG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoJ2RhdGEtYWN0aW9uJyk7XG5cbiAgICAgICAgICAgIHRoaXMuY29udHJvbChhY3Rpb24pO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGNvbnRyb2woYWN0aW9uKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTZW5kaW5nIGFjdGlvbjogJythY3Rpb24pO1xuICAgICAgICB0aGlzLnNvY2tldC5lbWl0KCdjb250cm9sJywgYWN0aW9uKTtcbiAgICB9XG5cbiAgICBzZXRQbGF5bGlzdChwbGF5bGlzdERhdGEpXG4gICAge1xuICAgICAgICAvLyBUcnkgYW5kIGFkZCB0aGlzIHBsYXlsaXN0XG4gICAgICAgIHRoaXMuYWRkUGxheWxpc3QocGxheWxpc3REYXRhLCB0cnVlKTtcblxuICAgICAgICB0aGlzLnBsYXlsaXN0SUQgPSBwbGF5bGlzdERhdGEuSUQ7XG4gICAgfVxuXG4gICAgYWRkUGxheWxpc3QocGxheWxpc3REYXRhLCBvdmVyd3JpdGUpXG4gICAge1xuICAgICAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGFscmVhZHkgbG9hZGVkIHRoaXMgcGxheWxpc3RcbiAgICAgICAgaWYgKG92ZXJ3cml0ZSA9PT0gdHJ1ZSB8fCB0eXBlb2YgdGhpcy5wbGF5bGlzdHNbcGxheWxpc3REYXRhLklEXSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWxpc3RzW3BsYXlsaXN0RGF0YS5JRF0gPSBuZXcgUGxheWxpc3QocGxheWxpc3REYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFBsYXlsaXN0KClcbiAgICB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0c1t0aGlzLnBsYXlsaXN0SURdO1xuICAgIH1cbn1cblxuXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQbGF5bGlzdCB7XG5cbiAgICBjb25zdHJ1Y3RvcihwbGF5bGlzdERhdGEpIHtcbiAgICAgICAgdGhpcy5JRCA9IHBsYXlsaXN0RGF0YS5JRDtcbiAgICAgICAgdGhpcy5zb25ncyA9IFtdO1xuICAgICAgICB0aGlzLkVsID0gJCgnLnF1ZXVlLWNvbnRhaW5lcicpO1xuICAgICAgICB0aGlzLmJ1aWxkKHBsYXlsaXN0RGF0YSk7XG4gICAgfVxuXG4gICAgYnVpbGQocGxheWxpc3REYXRhKVxuICAgIHtcbiAgICAgICAgLy9DbGVhciB0aGUgY3VycmVudCBwbGF5bGlzdFxuICAgICAgICB0aGlzLkVsLmh0bWwoJycpO1xuXG4gICAgICAgICQuZWFjaChwbGF5bGlzdERhdGEuc29uZ3MsIGZ1bmN0aW9uKGluZGV4LCBzb25nKSB7XG5cbiAgICAgICAgICAgIHRoaXMuYWRkU29uZyhzb25nKTtcblxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIGJ1aWxkU29uZyhzb25nKVxuICAgIHtcbiAgICAgICAgdmFyIGl0ZW0gPSAkKCc8ZGl2IC8+JywgeyAnY2xhc3MnOiAnc29uZ1Jlc3VsdCcsICdpZCc6ICdzb25nLScrc29uZy5pZCwgJ2RhdGEtc3RhdGUnOiBzb25nLnN0YXRlIH0pO1xuXG4gICAgICAgIHZhciBpbWFnZSA9ICQoJzxpbWcgLz4nLCB7IHNyYzogc29uZy50aHVtYm5haWwgfSk7XG4gICAgICAgIHZhciBkdXJhdGlvbiA9ICQoJzxwIC8+JywgeyAnY2xhc3MnOiAnZHVyYXRpb24nLCB0ZXh0OiAoc29uZy5kYXRhLmR1cmF0aW9uIC8gNjApLnRvRml4ZWQoMikgfSk7XG4gICAgICAgIHZhciB0aXRsZSA9ICQoJzxwIC8+JywgeyAnY2xhc3MnOiAndGl0bGUnLCB0ZXh0OiBzb25nLmRhdGEudGl0bGUgfSk7XG4gICAgICAgIHZhciBwcm9ncmVzcyA9ICQoJzxwcm9ncmVzcyAvPicsIHsgdmFsdWU6IHNvbmcucG9zaXRpb24sIG1heDogc29uZy5kYXRhLmR1cmF0aW9uIH0pO1xuICAgICAgICB2YXIgdXNlcm5hbWUgPSAkKCc8cCAvPicsIHsgJ2NsYXNzJzogJ3VzZXJuYW1lJywgdGV4dDogc29uZy51c2VybmFtZSB9KTtcblxuICAgICAgICB2YXIgaW1nd3JhcCA9ICQoJzxkaXYgLz4nLCB7ICdjbGFzcyc6ICdpbWFnZVdyYXBwZXInIH0pO1xuICAgICAgICB2YXIgY29udGVudHdyYXAgPSAkKCc8ZGl2IC8+JywgeyAnY2xhc3MnOiAnY29udGVudFdyYXBwZXInIH0pO1xuXG4gICAgICAgIGltZ3dyYXAuYXBwZW5kKGltYWdlKTtcbiAgICAgICAgY29udGVudHdyYXAuYXBwZW5kKHRpdGxlKTtcbiAgICAgICAgY29udGVudHdyYXAuYXBwZW5kKHByb2dyZXNzKTtcbiAgICAgICAgaXRlbS5hcHBlbmQoaW1nd3JhcCk7XG4gICAgICAgIGl0ZW0uYXBwZW5kKGNvbnRlbnR3cmFwKTtcbiAgICAgICAgaXRlbS5hcHBlbmQodXNlcm5hbWUpO1xuICAgICAgICBpdGVtLmFwcGVuZChkdXJhdGlvbik7XG5cbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfVxuXG4gICAgcmVtb3ZlU29uZyhzb25nVG9SZW1vdmUpXG4gICAge1xuICAgICAgICB0aGlzLkVsLmNoaWxkcmVuKCcjc29uZy0nK3NvbmdUb1JlbW92ZS5pZCkucmVtb3ZlKCk7XG5cbiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuc29uZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBzb25nID0gdGhpcy5zb25nc1tpXTtcblxuICAgICAgICAgICAgaWYoc29uZy5pZCA9PT0gc29uZ1RvUmVtb3ZlLmlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb25ncy5zcGxpY2UoaSwxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFNvbmcoc29uZylcbiAgICB7XG4gICAgICAgIHRoaXMuRWwuYXBwZW5kKHRoaXMuYnVpbGRTb25nKHNvbmcpKTtcbiAgICB9XG5cbiAgICB1cGRhdGVTb25nU3RhdHVzKHNvbmcpXG4gICAge1xuICAgICAgICB2YXIgc29uZ0VsID0gdGhpcy5FbC5maW5kKCcuc29uZ1Jlc3VsdCNzb25nLScgKyBzb25nLmlkKTtcbiAgICAgICAgc29uZ0VsLmF0dHIoJ2RhdGEtc3RhdGUnLCBzb25nLnN0YXRlKTtcbiAgICAgICAgc29uZ0VsLmZpbmQoJy5kdXJhdGlvbicpLnRleHQoKHNvbmcuZGF0YS5kdXJhdGlvbiAvIDYwKS50b0ZpeGVkKDIpKTtcbiAgICAgICAgc29uZ0VsLmZpbmQoJ3Byb2dyZXNzJykuYXR0cigndmFsdWUnLCBzb25nLnBvc2l0aW9uKTtcbiAgICAgICAgc29uZ0VsLmZpbmQoJ3Byb2dyZXNzJykuYXR0cignbWF4Jywgc29uZy5kYXRhLmR1cmF0aW9uKTtcbiAgICB9XG5cbiAgICB1cGRhdGVTb25nUG9zaXRpb24ocG9zaXRpb24pXG4gICAge1xuICAgICAgICB2YXIgc29uZ0VsID0gdGhpcy5FbC5maW5kKCcuc29uZ1Jlc3VsdFtkYXRhLXN0YXRlPXBsYXlpbmddJyk7XG4gICAgICAgIHNvbmdFbC5maW5kKCdwcm9ncmVzcycpLmF0dHIoJ3ZhbHVlJywgcG9zaXRpb24pO1xuICAgIH1cbn1cblxuXG5cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlYXJjaFxue1xuICAgIGNvbnN0cnVjdG9yKHNvY2tldCkge1xuICAgICAgICB0aGlzLnNvY2tldCA9IHNvY2tldDtcbiAgICAgICAgdGhpcy5kaWFsb2dFbCA9ICQoJyNhZGREaWFsb2cnKTtcbiAgICAgICAgdGhpcy51c2VyU2V0dXBFbCA9ICQoJyN1c2VyLXNldHVwJyk7XG4gICAgICAgIHRoaXMuc2VhcmNoQ29udHJvbHNFbCA9ICQoJyNzZWFyY2gtY29udHJvbHMnKTtcblxuICAgICAgICB0aGlzLmluaXRVc2VyKCk7XG4gICAgICAgIHRoaXMuaW5pdEdvb2dsZUFwaSh0aGlzLnNlYXJjaFJlYWR5KTtcbiAgICAgICAgdGhpcy5pbml0S2V5RXZlbnRzKCk7XG4gICAgICAgIHRoaXMuaW5pdENsaWNrRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgaW5pdFVzZXIoKVxuICAgIHtcbiAgICAgICAgaWYobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJuYW1lJykpIHtcbiAgICAgICAgICAgIHRoaXMudXNlclNldHVwRWwuaGlkZSgpO1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hDb250cm9sc0VsLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgICAkKCcjYWRkVXNlcicpLnN1Ym1pdCgoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKCQoJyN1c2VybmFtZScpLnZhbCgpICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndXNlcm5hbWUnLCAkKCcjdXNlcm5hbWUnKS52YWwoKSk7XG4gICAgICAgICAgICAgICAgdGhpcy51c2VyU2V0dXBFbC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hDb250cm9sc0VsLnNob3coKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2VhcmNoUmVhZHkoKVxuICAgIHtcbiAgICAgICAgJCgnI3NlYXJjaCcpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgIH1cblxuICAgIGluaXRHb29nbGVBcGkoY2FsbGJhY2spXG4gICAge1xuICAgICAgICBzZXRUaW1lb3V0KGdvb2dsZUFwaUNsaWVudFJlYWR5LCAxMDAwKTtcbiAgICAgICAgZnVuY3Rpb24gZ29vZ2xlQXBpQ2xpZW50UmVhZHkoKSB7XG4gICAgICAgICAgICBnYXBpLmNsaWVudC5zZXRBcGlLZXkoJ0FJemFTeUM1Wk5heFVFN0h3T3hpNnI1eE1xOWFlUmxVVmRKWFU3SScpO1xuICAgICAgICAgICAgZ2FwaS5hdXRoLmluaXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZ2FwaS5jbGllbnQubG9hZCgneW91dHViZScsICd2MycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdEtleUV2ZW50cygpIHtcbiAgICAgICAgJChkb2N1bWVudCkua2V5dXAoKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAvLyBVcC9Eb3duIGFuZCBqL2sga2V5cyB0byBuYXZpZ2F0ZSBzZWxlY3RpbmcgYSBzb25nXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSA0MCB8fCBldmVudC5rZXlDb2RlID09IDc0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCQoJy5oaWdobGlnaHQnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhpZ2hsaWdodGVkID0gJCgnLmhpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZC5uZXh0KCkuYWRkQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZC5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NlYXJjaC1jb250YWluZXIgPiAuc29uZ1Jlc3VsdDpmaXJzdC1jaGlsZCcpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMzggfHwgZXZlbnQua2V5Q29kZSA9PSA3NSkge1xuICAgICAgICAgICAgICAgIGlmICgkKCcuaGlnaGxpZ2h0JykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoaWdobGlnaHRlZCA9ICQoJy5oaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWQucHJldigpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWQucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBFc2MgY2xvc2VzIGRpYWxvZ1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMjcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSdW4gc2VhcmNoIG9uIGtleWRvd24gaW4gc2VhcmNoIGJveFxuICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5pcygnI3NlYXJjaCcpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMTMgJiYgJCgnLmhpZ2hsaWdodCcpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuaGlnaGxpZ2h0JykuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaCgkKCcjc2VhcmNoJykudmFsKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gS2V5cyB3aGVuIGZvcm0gaW5wdXQgaXNuJ3QgZm9jdXNlZFxuICAgICAgICAgICAgaWYgKCEkKGV2ZW50LnRhcmdldCkuaXMoJ2lucHV0JykpIHtcbiAgICAgICAgICAgICAgICAvLyBBIG9yIEVudGVyIHRyaWdnZXJzIGRpYWxvZ1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDY1IHx8IGV2ZW50LmtleUNvZGUgPT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlhbG9nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZWFyY2gocXVlcnkpXG4gICAge1xuICAgICAgICB2YXIgcmVxdWVzdCA9IGdhcGkuY2xpZW50LnlvdXR1YmUuc2VhcmNoLmxpc3Qoe1xuICAgICAgICAgICAgcTogcXVlcnksXG4gICAgICAgICAgICBwYXJ0OiAnc25pcHBldCcsXG4gICAgICAgICAgICBtYXhSZXN1bHRzOiAnMjUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlcXVlc3QuZXhlY3V0ZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICQoJyNzZWFyY2gtY29udGFpbmVyJykuaHRtbCgnJyk7XG4gICAgICAgICAgICAkLmVhY2gocmVzcG9uc2UucmVzdWx0Lml0ZW1zLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZC5raW5kID09IFwieW91dHViZSN2aWRlb1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQoJzxkaXYgLz4nLCB7J2NsYXNzJzogJ3NvbmdSZXN1bHQnfSk7XG4gICAgICAgICAgICAgICAgICAgIGVsLmRhdGEoJ3VybCcsIGl0ZW0uaWQudmlkZW9JZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9ICQoJzxpbWcgLz4nLCB7c3JjOiBpdGVtLnNuaXBwZXQudGh1bWJuYWlscy5kZWZhdWx0LnVybH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVzY1dyYXAgPSAkKCc8ZGl2IC8+Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9ICQoJzxwIC8+Jywge3RleHQ6IGl0ZW0uc25pcHBldC50aXRsZSwgJ2NsYXNzJzogJ3RpdGxlJ30pO1xuICAgICAgICAgICAgICAgICAgICAvL3ZhciBhdXRob3IgPSAkKCc8cCAvPicsIHsgdGV4dDogaXRlbS5zbmlwcGV0LmNoYW5uZWxUaXRsZSwgJ2NsYXNzJzogJ2Rlc2NyaXB0aW9uJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgZGVzY1dyYXAuYXBwZW5kKHRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgLy9kZXNjV3JhcC5hcHBlbmQoYXV0aG9yKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltZ3dyYXAgPSAkKCc8ZGl2IC8+JywgeydjbGFzcyc6ICdpbWFnZVdyYXBwZXInfSk7XG4gICAgICAgICAgICAgICAgICAgIGltZ3dyYXAuYXBwZW5kKGltYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kKGltZ3dyYXApO1xuICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmQoZGVzY1dyYXApO1xuICAgICAgICAgICAgICAgICAgICAkKCcjc2VhcmNoLWNvbnRhaW5lcicpLmFwcGVuZChlbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2hvd0RpYWxvZygpIHtcbiAgICAgICAgdGhpcy5kaWFsb2dFbC5zaG93KCk7XG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcm5hbWUnKSkge1xuICAgICAgICAgICAgJCgnI3NlYXJjaCcpLmZvY3VzKCkudmFsKCcnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJyN1c2VybmFtZScpLmZvY3VzKCkudmFsKCcnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsb3NlRGlhbG9nKClcbiAgICB7XG4gICAgICAgIHRoaXMuZGlhbG9nRWwuaGlkZSgpO1xuICAgIH1cblxuICAgIGluaXRDbGlja0V2ZW50cygpXG4gICAge1xuICAgICAgICAkKCcjYWRkQnV0dG9uJykuY2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaG93RGlhbG9nKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKCcjYWRkRGlhbG9nQ2xvc2UsIC5vdmVybGF5JykuY2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpO1xuICAgICAgICB9KTtcbiAgICAgICAgJCgnI3NlYXJjaC1jb250YWluZXInKS5vbignY2xpY2snLCAnPiBkaXYnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHZhciBzb25nID0ge1xuICAgICAgICAgICAgICAgIGlkOiAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmRhdGEoJ3VybCcpLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmZpbmQoJ3AudGl0bGUnKS50ZXh0KCksXG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsOiAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmZpbmQoJ2ltZycpLmF0dHIoJ3NyYycpLFxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcm5hbWUnKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuYWRkU29uZ1RvUGxheWxpc3Qoc29uZyk7XG4gICAgICAgICAgICAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmFkZENsYXNzKCdhZGRlZCcpO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGFkZFNvbmdUb1BsYXlsaXN0KHNvbmcpXG4gICAge1xuICAgICAgICBjb25zb2xlLmxvZygnQWRkaW5nLi4gJyArIHNvbmcuaWQpO1xuICAgICAgICB0aGlzLnNvY2tldC5lbWl0KCdhZGRzb25nJywgc29uZyk7XG4gICAgfVxufSJdfQ==
